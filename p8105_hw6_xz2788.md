p8105\_hw6\_xz2788
================
Xiaoyue Zhang
11/17/2018

First load necessary packages

``` r
library(tidyverse)
```

    ## ── Attaching packages ───────────────────────────────────────────────── tidyverse 1.2.1 ──

    ## ✔ ggplot2 3.0.0     ✔ purrr   0.2.5
    ## ✔ tibble  1.4.2     ✔ dplyr   0.7.6
    ## ✔ tidyr   0.8.1     ✔ stringr 1.3.1
    ## ✔ readr   1.1.1     ✔ forcats 0.3.0

    ## ── Conflicts ──────────────────────────────────────────────────── tidyverse_conflicts() ──
    ## ✖ dplyr::filter() masks stats::filter()
    ## ✖ dplyr::lag()    masks stats::lag()

``` r
library(leaps)
```

Problem 1
---------

Read in the raw data of homicides and parse columns

``` r
homicide = read_csv(file = "./data/homicide-data.csv",
                    col_types = "cccccdcccddc")
```

### Tidy data

Create a city\_state variable and a binary variable indicating whether the homicide is solved and tidy the dataset as required

``` r
homicide_tidy = homicide %>% 
  mutate(city_state = str_c(city, ",", state)) %>% 
  mutate(result = ifelse(disposition == "Closed by arrest", "solved", "unsolved")) %>% 
  filter(city_state != "Dallas,TX" & city_state != "Phoenix,AZ" & city_state != "Kansas City,MO" & city_state != "Tulsa,AL") %>% 
  mutate(victim_race = ifelse(victim_race == "White", "white", "non-white")) %>% 
  mutate(victim_race = as_factor(victim_race))

#relevel "race" factor, "white" as reference
homicide_tidy$victim_race = relevel(homicide_tidy$victim_race, ref = "white")
```

### Analysis in Baltimore

Fit a logistic regression model for Baltimore

``` r
#"unsolved" as reference group
homicide_tidy$result = relevel(as_factor(homicide_tidy$result), ref = "unsolved")
logi_balti = homicide_tidy %>% 
  filter(city_state == "Baltimore,MD") %>% 
  glm(result ~ victim_age + victim_sex + victim_race, data = ., family = "binomial") 
logi_balti %>%  broom::tidy()
```

    ## # A tibble: 4 x 5
    ##   term                 estimate std.error statistic  p.value
    ##   <chr>                   <dbl>     <dbl>     <dbl>    <dbl>
    ## 1 (Intercept)           1.19      0.235        5.06 4.30e- 7
    ## 2 victim_age           -0.00699   0.00326     -2.14 3.22e- 2
    ## 3 victim_sexMale       -0.888     0.136       -6.53 6.80e-11
    ## 4 victim_racenon-white -0.820     0.175       -4.69 2.68e- 6

Obtain the estimate and CI of OR

``` r
conf_inter = logi_balti %>% 
  broom::confint_tidy() %>% 
  mutate(conf.low = exp(conf.low), conf.high = exp(conf.high))
logi_balti %>% 
  broom::tidy() %>% 
  mutate(OR = exp(estimate)) %>% 
  select(term, OR, log_OR = estimate, p.value) %>% 
  cbind(., conf_inter) %>% 
  knitr::kable(digits = 3)
```

| term                  |     OR|  log\_OR|  p.value|  conf.low|  conf.high|
|:----------------------|------:|--------:|--------:|---------:|----------:|
| (Intercept)           |  3.274|    1.186|    0.000|     2.076|      5.212|
| victim\_age           |  0.993|   -0.007|    0.032|     0.987|      0.999|
| victim\_sexMale       |  0.412|   -0.888|    0.000|     0.315|      0.537|
| victim\_racenon-white |  0.441|   -0.820|    0.000|     0.312|      0.620|

From the results, we can see that in Baltimore, for non-white victims, the odds of solving homicides and unsolved ones is 0.44 times the odds of that of white victims with adjusting for age and sex, which also means that homicides of white victims were more likely to be solved.

### Build logistic regression for each of the city

First creat a function to extract OR and 95%CI

``` r
odds_confi = function(x){
  
  ci = broom::confint_tidy(x) %>% 
    mutate(conf.low = exp(conf.low), conf.high = exp(conf.high))
  or_ci = x %>% 
    broom::tidy() %>% 
    mutate(OR = exp(estimate)) %>% 
  select(term, OR, log_OR = estimate) %>% 
  cbind(., ci)
  
  return(or_ci)
  
}
```

Conduct glm in each city and delete "Unknown" victim sex for later modeling

``` r
each_city = homicide_tidy %>% 
  filter(victim_sex != "Unknown") %>% 
  group_by(city_state) %>% 
  nest() %>% 
  mutate(model = map(data, ~glm(result ~ victim_age + victim_sex + victim_race, data = .x, family = "binomial"))) %>% 
  mutate(model = map(model, odds_confi)) %>% 
  select(-data) %>% 
  unnest()
head(each_city)
```

    ## # A tibble: 6 x 6
    ##   city_state     term                    OR  log_OR conf.low conf.high
    ##   <chr>          <chr>                <dbl>   <dbl>    <dbl>     <dbl>
    ## 1 Albuquerque,NM (Intercept)          3.62   1.29      1.72      7.94 
    ## 2 Albuquerque,NM victim_age           0.976 -0.0244    0.962     0.989
    ## 3 Albuquerque,NM victim_sexMale       1.58   0.455     0.890     2.78 
    ## 4 Albuquerque,NM victim_racenon-white 0.738 -0.304     0.447     1.21 
    ## 5 Atlanta,GA     (Intercept)          3.17   1.15      1.57      6.52 
    ## 6 Atlanta,GA     victim_age           0.988 -0.0118    0.979     0.997

Make a plot to show ORs and CIs for each city

``` r
each_city %>% 
  filter(term == "victim_racenon-white") %>% 
  transform(city_state = reorder(city_state, OR)) %>% 
  ggplot(aes(x = city_state, y = OR)) +
  geom_point() +
  geom_errorbar(aes(ymin = conf.low, ymax = conf.high)) +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  labs(
    title = "Estimated odds ratio and 95% CI of race",
    x = "City",
    y = "Estimated odds ratio of race",
    caption = "Data from the Washington Post"
  ) +
  theme(legend.position = "bottom")
```

![](p8105_hw6_xz2788_files/figure-markdown_github/plot_each_city-1.png)

Comment: Across the cities, Boston has the lowest estimated odds ratio for solving homicides comparing non-white victims to white victims and Tampa, FL has the highes estimated odds ratio. Only Durham and Tampa have estimated odds ratio over 1 which means in these cities, homicides of non-white victims are more likely to be solved while all other cities were the opposite, but the confidence interval included 1 which meas actually no difference between the odds ration in non-white and white victims.

Problem 2
---------

Read in the data first

``` r
birthweight = read_csv(file = "./data/birthweight.csv.csv")
```

    ## Parsed with column specification:
    ## cols(
    ##   .default = col_integer(),
    ##   gaweeks = col_double(),
    ##   ppbmi = col_double(),
    ##   smoken = col_double()
    ## )

    ## See spec(...) for full column specifications.

Look at the data first and check NAs

``` r
str(birthweight)
```

    ## Classes 'tbl_df', 'tbl' and 'data.frame':    4342 obs. of  20 variables:
    ##  $ babysex : int  2 1 2 1 2 1 2 2 1 1 ...
    ##  $ bhead   : int  34 34 36 34 34 33 33 33 36 33 ...
    ##  $ blength : int  51 48 50 52 52 52 46 49 52 50 ...
    ##  $ bwt     : int  3629 3062 3345 3062 3374 3374 2523 2778 3515 3459 ...
    ##  $ delwt   : int  177 156 148 157 156 129 126 140 146 169 ...
    ##  $ fincome : int  35 65 85 55 5 55 96 5 85 75 ...
    ##  $ frace   : int  1 2 1 1 1 1 2 1 1 2 ...
    ##  $ gaweeks : num  39.9 25.9 39.9 40 41.6 ...
    ##  $ malform : int  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ menarche: int  13 14 12 14 13 12 14 12 11 12 ...
    ##  $ mheight : int  63 65 64 64 66 66 72 62 61 64 ...
    ##  $ momage  : int  36 25 29 18 20 23 29 19 13 19 ...
    ##  $ mrace   : int  1 2 1 1 1 1 2 1 1 2 ...
    ##  $ parity  : int  3 0 0 0 0 0 0 0 0 0 ...
    ##  $ pnumlbw : int  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ pnumsga : int  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ ppbmi   : num  26.3 21.3 23.6 21.8 21 ...
    ##  $ ppwt    : int  148 128 137 127 130 115 105 119 105 145 ...
    ##  $ smoken  : num  0 0 1 10 1 0 0 0 0 4 ...
    ##  $ wtgain  : int  29 28 11 30 26 14 21 21 41 24 ...
    ##  - attr(*, "spec")=List of 2
    ##   ..$ cols   :List of 20
    ##   .. ..$ babysex : list()
    ##   .. .. ..- attr(*, "class")= chr  "collector_integer" "collector"
    ##   .. ..$ bhead   : list()
    ##   .. .. ..- attr(*, "class")= chr  "collector_integer" "collector"
    ##   .. ..$ blength : list()
    ##   .. .. ..- attr(*, "class")= chr  "collector_integer" "collector"
    ##   .. ..$ bwt     : list()
    ##   .. .. ..- attr(*, "class")= chr  "collector_integer" "collector"
    ##   .. ..$ delwt   : list()
    ##   .. .. ..- attr(*, "class")= chr  "collector_integer" "collector"
    ##   .. ..$ fincome : list()
    ##   .. .. ..- attr(*, "class")= chr  "collector_integer" "collector"
    ##   .. ..$ frace   : list()
    ##   .. .. ..- attr(*, "class")= chr  "collector_integer" "collector"
    ##   .. ..$ gaweeks : list()
    ##   .. .. ..- attr(*, "class")= chr  "collector_double" "collector"
    ##   .. ..$ malform : list()
    ##   .. .. ..- attr(*, "class")= chr  "collector_integer" "collector"
    ##   .. ..$ menarche: list()
    ##   .. .. ..- attr(*, "class")= chr  "collector_integer" "collector"
    ##   .. ..$ mheight : list()
    ##   .. .. ..- attr(*, "class")= chr  "collector_integer" "collector"
    ##   .. ..$ momage  : list()
    ##   .. .. ..- attr(*, "class")= chr  "collector_integer" "collector"
    ##   .. ..$ mrace   : list()
    ##   .. .. ..- attr(*, "class")= chr  "collector_integer" "collector"
    ##   .. ..$ parity  : list()
    ##   .. .. ..- attr(*, "class")= chr  "collector_integer" "collector"
    ##   .. ..$ pnumlbw : list()
    ##   .. .. ..- attr(*, "class")= chr  "collector_integer" "collector"
    ##   .. ..$ pnumsga : list()
    ##   .. .. ..- attr(*, "class")= chr  "collector_integer" "collector"
    ##   .. ..$ ppbmi   : list()
    ##   .. .. ..- attr(*, "class")= chr  "collector_double" "collector"
    ##   .. ..$ ppwt    : list()
    ##   .. .. ..- attr(*, "class")= chr  "collector_integer" "collector"
    ##   .. ..$ smoken  : list()
    ##   .. .. ..- attr(*, "class")= chr  "collector_double" "collector"
    ##   .. ..$ wtgain  : list()
    ##   .. .. ..- attr(*, "class")= chr  "collector_integer" "collector"
    ##   ..$ default: list()
    ##   .. ..- attr(*, "class")= chr  "collector_guess" "collector"
    ##   ..- attr(*, "class")= chr "col_spec"

``` r
skimr::skim(birthweight)
```

    ## Skim summary statistics
    ##  n obs: 4342 
    ##  n variables: 20 
    ## 
    ## ── Variable type:integer ─────────────────────────────────────────────────────────────────
    ##  variable missing complete    n      mean      sd  p0  p25    p50  p75
    ##   babysex       0     4342 4342    1.49     0.5     1    1    1      2
    ##     bhead       0     4342 4342   33.65     1.62   21   33   34     35
    ##   blength       0     4342 4342   49.75     2.72   20   48   50     51
    ##       bwt       0     4342 4342 3114.4    512.15  595 2807 3132.5 3459
    ##     delwt       0     4342 4342  145.57    22.21   86  131  143    157
    ##   fincome       0     4342 4342   44.11    25.98    0   25   35     65
    ##     frace       0     4342 4342    1.66     0.85    1    1    2      2
    ##   malform       0     4342 4342    0.0035   0.059   0    0    0      0
    ##  menarche       0     4342 4342   12.51     1.48    0   12   12     13
    ##   mheight       0     4342 4342   63.49     2.66   48   62   63     65
    ##    momage       0     4342 4342   20.3      3.88   12   18   20     22
    ##     mrace       0     4342 4342    1.63     0.77    1    1    2      2
    ##    parity       0     4342 4342    0.0023   0.1     0    0    0      0
    ##   pnumlbw       0     4342 4342    0        0       0    0    0      0
    ##   pnumsga       0     4342 4342    0        0       0    0    0      0
    ##      ppwt       0     4342 4342  123.49    20.16   70  110  120    134
    ##    wtgain       0     4342 4342   22.08    10.94  -46   15   22     28
    ##  p100     hist
    ##     2 ▇▁▁▁▁▁▁▇
    ##    41 ▁▁▁▁▅▇▁▁
    ##    63 ▁▁▁▁▁▇▁▁
    ##  4791 ▁▁▁▃▇▇▂▁
    ##   334 ▁▇▅▁▁▁▁▁
    ##    96 ▁▂▇▂▂▂▁▃
    ##     8 ▇▇▁▁▁▁▁▁
    ##     1 ▇▁▁▁▁▁▁▁
    ##    19 ▁▁▁▁▂▇▁▁
    ##    77 ▁▁▁▅▇▂▁▁
    ##    44 ▂▇▅▂▁▁▁▁
    ##     4 ▇▁▇▁▁▁▁▁
    ##     6 ▇▁▁▁▁▁▁▁
    ##     0 ▁▁▁▇▁▁▁▁
    ##     0 ▁▁▁▇▁▁▁▁
    ##   287 ▁▇▆▁▁▁▁▁
    ##    89 ▁▁▁▇▇▁▁▁
    ## 
    ## ── Variable type:numeric ─────────────────────────────────────────────────────────────────
    ##  variable missing complete    n  mean   sd    p0   p25   p50   p75 p100
    ##   gaweeks       0     4342 4342 39.43 3.15 17.7  38.3  39.9  41.1  51.3
    ##     ppbmi       0     4342 4342 21.57 3.18 13.07 19.53 21.03 22.91 46.1
    ##    smoken       0     4342 4342  4.15 7.41  0     0     0     5    60  
    ##      hist
    ##  ▁▁▁▁▃▇▁▁
    ##  ▁▇▅▁▁▁▁▁
    ##  ▇▁▁▁▁▁▁▁

From the result, we can see that there is no missing value in all variables, but the classes of some variables should to be tidied.

### Tidy data

``` r
birthweight = birthweight %>% 
  mutate(babysex = as.factor(babysex),
         frace = as.factor(frace),
         malform = as.factor(malform),
         mrace = as.factor(mrace))
```

### Modeling process

Select variables into the model by stepwise method

``` r
regsubsets(bwt~., data = birthweight, nvmax = 5, method = "seqrep") %>% 
  summary()
```

    ## Warning in leaps.setup(x, y, wt = wt, nbest = nbest, nvmax = nvmax,
    ## force.in = force.in, : 3 linear dependencies found

    ## Reordering variables and trying again:

    ## Subset selection object
    ## Call: regsubsets.formula(bwt ~ ., data = birthweight, nvmax = 5, method = "seqrep")
    ## 24 Variables  (and intercept)
    ##          Forced in Forced out
    ## babysex2     FALSE      FALSE
    ## bhead        FALSE      FALSE
    ## blength      FALSE      FALSE
    ## delwt        FALSE      FALSE
    ## fincome      FALSE      FALSE
    ## frace2       FALSE      FALSE
    ## frace3       FALSE      FALSE
    ## frace4       FALSE      FALSE
    ## frace8       FALSE      FALSE
    ## gaweeks      FALSE      FALSE
    ## malform1     FALSE      FALSE
    ## menarche     FALSE      FALSE
    ## mheight      FALSE      FALSE
    ## momage       FALSE      FALSE
    ## mrace2       FALSE      FALSE
    ## mrace3       FALSE      FALSE
    ## mrace4       FALSE      FALSE
    ## parity       FALSE      FALSE
    ## ppbmi        FALSE      FALSE
    ## ppwt         FALSE      FALSE
    ## smoken       FALSE      FALSE
    ## pnumlbw      FALSE      FALSE
    ## pnumsga      FALSE      FALSE
    ## wtgain       FALSE      FALSE
    ## 1 subsets of each size up to 6
    ## Selection Algorithm: 'sequential replacement'
    ##          babysex2 bhead blength delwt fincome frace2 frace3 frace4 frace8
    ## 1  ( 1 ) " "      "*"   " "     " "   " "     " "    " "    " "    " "   
    ## 2  ( 1 ) " "      "*"   "*"     " "   " "     " "    " "    " "    " "   
    ## 3  ( 1 ) " "      "*"   "*"     " "   " "     " "    " "    " "    " "   
    ## 4  ( 1 ) " "      "*"   "*"     "*"   " "     " "    " "    " "    " "   
    ## 5  ( 1 ) " "      "*"   "*"     "*"   " "     " "    " "    " "    " "   
    ## 6  ( 1 ) " "      "*"   "*"     "*"   " "     " "    " "    " "    " "   
    ##          gaweeks malform1 menarche mheight momage mrace2 mrace3 mrace4
    ## 1  ( 1 ) " "     " "      " "      " "     " "    " "    " "    " "   
    ## 2  ( 1 ) " "     " "      " "      " "     " "    " "    " "    " "   
    ## 3  ( 1 ) " "     " "      " "      " "     " "    "*"    " "    " "   
    ## 4  ( 1 ) " "     " "      " "      " "     " "    "*"    " "    " "   
    ## 5  ( 1 ) "*"     " "      " "      " "     " "    "*"    " "    " "   
    ## 6  ( 1 ) "*"     " "      " "      " "     " "    "*"    " "    " "   
    ##          parity pnumlbw pnumsga ppbmi ppwt smoken wtgain
    ## 1  ( 1 ) " "    " "     " "     " "   " "  " "    " "   
    ## 2  ( 1 ) " "    " "     " "     " "   " "  " "    " "   
    ## 3  ( 1 ) " "    " "     " "     " "   " "  " "    " "   
    ## 4  ( 1 ) " "    " "     " "     " "   " "  " "    " "   
    ## 5  ( 1 ) " "    " "     " "     " "   " "  " "    " "   
    ## 6  ( 1 ) " "    " "     " "     " "   " "  "*"    " "

From the result, we can see that "bhead", "blength", "mrace", "delwt", "gaweeks" can be selected into the model, but from knowledge of medicine, "malform", "wtgain", "pnumlbw" and "pnumsga" can also be related to the birthweight of the baby, but because all the data for "pnumsga" and "pnumlbw" is 0, thus they can be removed from the model

``` r
lm(bwt~bhead + blength + mrace + delwt + gaweeks, data = birthweight) %>% 
  summary()
```

    ## 
    ## Call:
    ## lm(formula = bwt ~ bhead + blength + mrace + delwt + gaweeks, 
    ##     data = birthweight)
    ## 
    ## Residuals:
    ##      Min       1Q   Median       3Q      Max 
    ## -1093.28  -184.30    -2.72   175.43  2391.18 
    ## 
    ## Coefficients:
    ##               Estimate Std. Error t value Pr(>|t|)    
    ## (Intercept) -5870.8739    96.9590 -60.550  < 2e-16 ***
    ## bhead         131.7275     3.4447  38.241  < 2e-16 ***
    ## blength        77.0253     2.0329  37.889  < 2e-16 ***
    ## mrace2       -126.7723     8.9834 -14.112  < 2e-16 ***
    ## mrace3        -51.5992    42.7804  -1.206    0.228    
    ## mrace4       -102.5200    18.8393  -5.442 5.56e-08 ***
    ## delwt           2.1598     0.1973  10.945  < 2e-16 ***
    ## gaweeks        11.8719     1.4671   8.092 7.56e-16 ***
    ## ---
    ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
    ## 
    ## Residual standard error: 276.4 on 4334 degrees of freedom
    ## Multiple R-squared:  0.7092, Adjusted R-squared:  0.7087 
    ## F-statistic:  1510 on 7 and 4334 DF,  p-value: < 2.2e-16

``` r
lm(bwt~bhead + blength + mrace + delwt + gaweeks + 
     malform + wtgain, data = birthweight) %>% 
  summary()
```

    ## 
    ## Call:
    ## lm(formula = bwt ~ bhead + blength + mrace + delwt + gaweeks + 
    ##     malform + wtgain, data = birthweight)
    ## 
    ## Residuals:
    ##      Min       1Q   Median       3Q      Max 
    ## -1082.96  -184.22    -1.44   177.74  2402.58 
    ## 
    ## Coefficients:
    ##               Estimate Std. Error t value Pr(>|t|)    
    ## (Intercept) -5786.9445    97.8843 -59.120  < 2e-16 ***
    ## bhead         131.0666     3.4361  38.144  < 2e-16 ***
    ## blength        76.5308     2.0288  37.722  < 2e-16 ***
    ## mrace2       -127.8050     8.9603 -14.263  < 2e-16 ***
    ## mrace3        -59.5647    42.6714  -1.396    0.163    
    ## mrace4       -104.2739    18.7861  -5.551 3.02e-08 ***
    ## delwt           1.7044     0.2138   7.970 2.01e-15 ***
    ## gaweeks        11.3318     1.4659   7.730 1.32e-14 ***
    ## malform1      -13.7999    71.3508  -0.193    0.847    
    ## wtgain          2.3177     0.4265   5.434 5.81e-08 ***
    ## ---
    ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
    ## 
    ## Residual standard error: 275.5 on 4332 degrees of freedom
    ## Multiple R-squared:  0.7111, Adjusted R-squared:  0.7105 
    ## F-statistic:  1185 on 9 and 4332 DF,  p-value: < 2.2e-16

``` r
#check the collinearity among selected variables
birthweight %>% 
  select(bwt, bhead, blength, delwt, gaweeks, wtgain) %>% 
  cor()
```

    ##               bwt     bhead   blength     delwt   gaweeks    wtgain
    ## bwt     1.0000000 0.7471068 0.7434508 0.2878893 0.4121833 0.2472526
    ## bhead   0.7471068 1.0000000 0.6304548 0.2143707 0.3784565 0.1833337
    ## blength 0.7434508 0.6304548 1.0000000 0.2291494 0.3592637 0.1912238
    ## delwt   0.2878893 0.2143707 0.2291494 1.0000000 0.1242785 0.4247883
    ## gaweeks 0.4121833 0.3784565 0.3592637 0.1242785 1.0000000 0.1481460
    ## wtgain  0.2472526 0.1833337 0.1912238 0.4247883 0.1481460 1.0000000

Compare models with/without "delwt" and "wtgain"

``` r
model_1 = lm(bwt~bhead + blength + mrace + gaweeks + malform + delwt, data = birthweight)
model_2 = lm(bwt~bhead + blength + mrace + gaweeks + malform + delwt + wtgain, data = birthweight)
anova(model_1, model_2)
```

    ## Analysis of Variance Table
    ## 
    ## Model 1: bwt ~ bhead + blength + mrace + gaweeks + malform + delwt
    ## Model 2: bwt ~ bhead + blength + mrace + gaweeks + malform + delwt + wtgain
    ##   Res.Df       RSS Df Sum of Sq     F    Pr(>F)    
    ## 1   4333 331144077                                 
    ## 2   4332 328902047  1   2242030 29.53 5.808e-08 ***
    ## ---
    ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

``` r
summary(model_1)
```

    ## 
    ## Call:
    ## lm(formula = bwt ~ bhead + blength + mrace + gaweeks + malform + 
    ##     delwt, data = birthweight)
    ## 
    ## Residuals:
    ##      Min       1Q   Median       3Q      Max 
    ## -1093.28  -184.30    -2.72   175.43  2391.14 
    ## 
    ## Coefficients:
    ##               Estimate Std. Error t value Pr(>|t|)    
    ## (Intercept) -5870.8435    96.9767 -60.539  < 2e-16 ***
    ## bhead         131.7284     3.4452  38.235  < 2e-16 ***
    ## blength        77.0244     2.0334  37.879  < 2e-16 ***
    ## mrace2       -126.7790     8.9878 -14.106  < 2e-16 ***
    ## mrace3        -51.6078    42.7865  -1.206    0.228    
    ## mrace4       -102.5300    18.8451  -5.441 5.60e-08 ***
    ## gaweeks        11.8715     1.4673   8.091 7.64e-16 ***
    ## malform1       -1.9305    71.5518  -0.027    0.978    
    ## delwt           2.1599     0.1974  10.943  < 2e-16 ***
    ## ---
    ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
    ## 
    ## Residual standard error: 276.4 on 4333 degrees of freedom
    ## Multiple R-squared:  0.7092, Adjusted R-squared:  0.7086 
    ## F-statistic:  1321 on 8 and 4333 DF,  p-value: < 2.2e-16

``` r
summary(model_2)
```

    ## 
    ## Call:
    ## lm(formula = bwt ~ bhead + blength + mrace + gaweeks + malform + 
    ##     delwt + wtgain, data = birthweight)
    ## 
    ## Residuals:
    ##      Min       1Q   Median       3Q      Max 
    ## -1082.96  -184.22    -1.44   177.74  2402.58 
    ## 
    ## Coefficients:
    ##               Estimate Std. Error t value Pr(>|t|)    
    ## (Intercept) -5786.9445    97.8843 -59.120  < 2e-16 ***
    ## bhead         131.0666     3.4361  38.144  < 2e-16 ***
    ## blength        76.5308     2.0288  37.722  < 2e-16 ***
    ## mrace2       -127.8050     8.9603 -14.263  < 2e-16 ***
    ## mrace3        -59.5647    42.6714  -1.396    0.163    
    ## mrace4       -104.2739    18.7861  -5.551 3.02e-08 ***
    ## gaweeks        11.3318     1.4659   7.730 1.32e-14 ***
    ## malform1      -13.7999    71.3508  -0.193    0.847    
    ## delwt           1.7044     0.2138   7.970 2.01e-15 ***
    ## wtgain          2.3177     0.4265   5.434 5.81e-08 ***
    ## ---
    ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
    ## 
    ## Residual standard error: 275.5 on 4332 degrees of freedom
    ## Multiple R-squared:  0.7111, Adjusted R-squared:  0.7105 
    ## F-statistic:  1185 on 9 and 4332 DF,  p-value: < 2.2e-16

Because although adding "wtgain" can increase the adjusted R-square, but the magnitude is not big, thus I choose to not include "wtgain" and "malform" seems not to have effect on birthweigt, thus the final regression model is as below:

``` r
birth_model = lm(bwt~bhead + blength + mrace + gaweeks + malform + delwt, data = birthweight)
```

Make a plot

``` r
birthweight %>% 
  modelr::add_predictions(birth_model) %>% 
  modelr::add_residuals(birth_model) %>% 
  ggplot(aes(x = pred, y = resid)) + 
  geom_point()
```

![](p8105_hw6_xz2788_files/figure-markdown_github/plot_regression-1.png)
